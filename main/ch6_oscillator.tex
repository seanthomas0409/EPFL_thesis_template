% !TEX root = ../sethomas_thesis_main.tex

\chapter{Integrating Control Systems into SMA Actuators}
% Here, in this chapter, a novel control mechanical control strategy and SMA actuator is showcased and studied.

% Goal : Present the principle of integrated control systems in SMA Actuators
% Problem : Most SMA actuators require advanced control systems and complex control strategies to create actuators. This results in mechanisms that are less spatially efficient
% Solution : By integrating the SME and its mechanical connection to temperature into the control structure, this dependence can be exploited to create a novel control solution

\section{Introduction}
% Present different control structures : sensors and sensorless
Shape Memory Alloys, often referred to as artificial muscles, are often used in applications where a compact and lightweight solution is required. When paired with a biasing element such as a spring or compliant mechanism, a lightweight reversible actuator can be fabricated. By heating and cooling the active SMA element, a reversible back and forth motion can be created.

Due to the complex nature of the shape memory effect, sensors or complex control strategies are required for the accurate control of the SMA element, as shown in the work by \todocite and \todocite. The SMA, if overheated, can result in the permanent reprogramming of the shape or the destruction of the SMA wire or coil. In the case of smaller, more compact applications, the SMA element used are thin wires or coil. In these cases, using sensors that can measure the temperature can be quite difficult to implement due to the low thermal mass of the SMA element. Recent work such as \todocite, have implemented sensorless systems where the change in resistivity is measure as the SMA changes phase to create more compact control solutions. Here, due to the complex nonlinear nature of the shape memory effect requires complex control strategies and micro-controllers to efficiently control the SMA and prevent overheating.

Often, when considering the volumetric work density of SMA actuators, the electronics, sensors and control strategies are not taken into account. In certain applications, for example untethered crawling robots, the control plays an important role in the final work-weight density of the robot as seen in the work by \todocite. Improvements made in the sensorless and control strategies can, thus, have a major impact in the final dimensions and weight of the SMA actuator.

In this chapter, a novel design concept is presented to further integrate the discrete building blocks present in the traditional SMA actuator. By exploiting the dependence of the mechanical behaviour of the SMA and its temperature, a mechanical oscillator system can be developed such that an electronics-free SMA actuator can be designed. This design language can be implemented into SMA actuators to create a simple but effective solution to create a sensorless, micro-controller-free control strategy that intrinsically present SMA overheating. Furthermore, in this chapter, a crawling robot is conceived using this methodology to validate this novel design approach.

\section{Design Methodology for the Control System}
% Concept and working principle
As mentioned previously, due to the complex behaviour of SMAs, the sensors and control strategies required to actuate an SMA actuator can be cumbersome and reduce the overall work-weight density of the resulting robotic systems. The shape memory effect and the corresponding phase transitions are directly dependant on the temperature of the alloy. By exploiting this mechanical relationship between the temperature of SMA, the control system can be integrated into the kinematic stage, as represented in \cref{fig:building-blocks-ct}.

% Building blocks figure
\begin{figure}[h] % t for top of the page, H could be put to impose the position of the float
  \centering
  \begin{tikzpicture}
    \node[anchor=south west,inner sep=0] (graph) at (0,0) {\includegraphics[trim={0 0 0 0},clip, width=0.8\textwidth]{images/chap6/hexgon-base-layer-intersect-ct.pdf}};
	% Insert a relative reference based on image dimensions
    \begin{scope}[x={(graph.south east)},y={(graph.north west)}]
    \node[] at (0.19, 0.5) {\textcolor{white}{\large Active Element}};
    \node[] at (0.5, 0.75) {\textcolor{white}{\large Kinematic Stage}};
    \node[] at (0.5, 0.25) {\textcolor{white}{\large Control Stage}};
    \node[] at (0.81, 0.5) {\textcolor{white}{\large Biasing Element}};
    \end{scope}
    \end{tikzpicture}
  \caption{Diagram of the adapted building blocks of the SMA actuator.}
  \label{fig:building-blocks-ct}
\end{figure}

\subsection{Working principle}
% example of similar solutions (or primitive tries)

A basic linear SMA actuator consists of an SMA and a biasing spring that when heated and cooled, results in a simple back forth oscillating motion. By accurately controlling the temperature of the SMA above its transition temperature and below a critical overheating temperature, the SMA can be made to provide a reliable actuation. This reversible actuation results in a back and forth mechanical movement of the biasing spring and the cyclical movement of the kinematic stage, if any. The basic concept of this methodology consists of tying the mechanical behaviour of the actuator into the control.

The SMA element in most cases is heating using Joule's heating by simply passing a current through the SMA and allowing the internal resistance of the SMA element to heat up by Joule's losses as shown in the work by \todocite. The cooling of the SMA generally consists of passively extracting the heat from the active element using natural convection with the cooler surrounding air. This simple strategy is often used in the control of SMA actuators due to not requiring any additional mechanisms and thus, does not reduce the work-density of the actuator while keeping the system compact.

Thus, by using the mechanical behaviour of the actuator to cut the current flow across the SMA will immediately cool the active element before it has a chance to overheat. In this manner, the control of the SMA actuator is mechanical controlled by the shape memory effect. Here, as a current is passed through the SMA wire or coil, it heats up the SMA resulting in a strain recovery and the SMA returning to its original length. This change in length, after a certain threshold, can be made to physically cut the electrical contact between the SMA element and the power supply. This cause the immediate cooling of the SMA through heat exchange with the surrounding air. As the SMA cools down, the biasing element will, once again, deform the SMA which will re-establish the electrical contact across the SMA, restarting the oscillating motion. Thus, this design strategy when integrated into the kinematic stage can render the entire SMA actuator compact and electronics-free.

% Advantages (maybe examples)
This approach, when properly implemented, can result in an robotic system where a reversible actuation can be observed without the need for any electronics, micro-controllers or sensors, preserving the work-weight density of the system. A mechanical control of the SMA element can result in a system where the SMA element, due to the physical electrical contacts being interrupted, can never overheat.

\subsection{Implementation}\label{sec:magnetic-latch}
% Implementation
The basic implementation of such as system consists of using a latch system or multi-stable mechanism where after a certain stroke or force threshold results in a snap-through effect that can be exploited to disconnect the electrical contacts across the SMA wire or coil. The rapid bifurcation or spring back from a latch system is used to cut the flow of current across from the SMA and the slow return of the SMA actuator due to cooling can be used to re-establish the electrical connection to create this oscillating effect.

The implementation of this oscillator mechanism in the scope of a simple biased-spring SMA actuator consists of a magnetic or mechanical latch system. A diagram of the working principle of the proof-of-concept can be in \cref{fig:oscillator-schematic}. The latch, here, consists of a magnet mounted on a leaf spring that is attracted to the end-effector of the bias-spring SMA actuator. The electrical current, in this case, is made to flow across the conductive magnet and into the SMA coil. Thus, only as the the magnet attaches to the end-effector of the SMA actuator will the SMA coil be heated using Joule's losses. Essentially, as the magnet and the SMA coil makes contact, the SMA element is heated and reduces in size due to the shape memory effect. During this phase, the magnet, which is mounted to a leaf spring, experiences a return force, $F_\textrm{S}$, and will continue to follow the actuator. Once, this force exceeds the attractive magnetic force, $F_\textrm{mag}$, between the magnet and the SMA coil, the latch detaches and immediately returns to its original location. This spring back occurs due to the resting return force of the leaf spring attached to the magnet. This concept can be implement in numerous ways including a mechanical latch mounted on a passive spring. Once this snap-through occurs, the electrical connection and the electrical current across the SMA is cut and will only be re-established when the bias spring of the SMA deforms the SMA coil and extends it back towards the latch. In this manner, the oscillating behaviour is observed without any sensors, micro-controllers or electronics.


\begin{figure}[ht] % t for top of the page, H could be put to impose the position of the float
  \centering
  \resizebox{0.6\textwidth}{!}{\input{images/chap6/proto-schematic.eps_tex}}
  \caption{Diagram showing the working principle of the magnetic latch system implemented in the SMA oscillator.}
  \label{fig:oscillator-schematic}
\end{figure}


% Bias spring using flexural linear stage
As mentioned earlier, using a flexure-based mechanism permits the omission of a dedicated spring in the design. As seen in \cref{fig:proto-full}, a proof-of-concept of this design methodology is implemented. Here, the linear stage is comprised of two parallel cantilever beams that also behaves as leaf springs. These biasing leaf springs apply a tractional return force on the SMA coil at a lower temperature while also preventing any unwanted degrees of freedom in the other axis. Another leaf spring is used to apply the return spring force required in the magnetic latch. Here, the SMA actuator is heated using the magnetic latch system and the snap-through of the latch occurs when the return force of the leaf spring exceeds the attractive force of the magnet, $F_\textrm{S}>F_\textrm{mag}$. Therefore, the required contraction of the SMA coil, $\varepsilon$, can be controlled by sizing the leaf spring associated with the magnet.
\begin{equation}\label{eq:osc-stroke-sizing}
    \varepsilon = \frac{F_\textrm{mag}}{K_s}
\end{equation}
where $K_s$ is the rigidity of the leaf spring which depends on the dimensions of the cantilever beams and can be calculated using the analytical model described in the works by \cite{rubbertIsotropicSpringsBased2016} and \cite{heneinParallelSpringStages1998}.

\begin{figure}[ht] % t for top of the page, H could be put to impose the position of the float
  \centering
  \begin{tikzpicture}
    \begin{scope}[x={(graph.south east)},y={(graph.north west)}]
        \node[anchor=south west,inner sep=0] (image) at (0,0) {\includegraphics[width=0.75\textwidth]{images/chap6/proto-full.jpg}};
    \end{scope}
  \end{tikzpicture}%
  \caption{The integrated SMA control system implemented using a flexure-based magnetic latch creating an SMA mechanical oscillator.}
  \label{fig:proto-full}
\end{figure}

\begin{figure}[ht] % t for top of the page, H could be put to impose the position of the float
  \centering
  \begin{annotationimage}{trim={0 0cm 0 20cm},clip, width=0.75\textwidth}{images/chap6/proto-closeup.jpg}
   \draw[annotation right = {SMA Coil at 0.6}] to (0.85,0.48);
   \draw[annotation left = {Magnet at 0.6}] to (0.47,0.5);
   \draw[coordinate label = {Bias Leaf Spring at (0.74,0.1)}];
   \draw[coordinate label = {Leaf Spring at (0.27,0.1)}];
 \end{annotationimage}
  \caption{The close-up structure of the magnetic latch system that acts as the oscillating electrical contact for the SMA coil. Here, the biasing leaf spring also act as a linear stage for the actuator.}
  \label{fig:proto-closeup}
\end{figure}

Here, in this proof-of-concept, the magnetic latch consists of a small magnet, with an attractive force of $150$ g, mounted on a thin leaf spring measuring $500\mu\mathrm{m}\times2.5\mathrm{mm}\times30\mathrm{mm}$. An M2 screw is used to clamp an electrically conductive wire to the magnet and acts as the ground of the electrical circuit. The magnet latches onto another ferromagnetic M2 screw which is mounted to the end-effector of the SMA actuator, as seen in \cref{fig:proto-closeup}. The SMA is supplied by \textit{Dynalloy, Inc} (Irvine, CA) and is a 90\degreeC Flexinol\textsuperscript{\textregistered} coil with wire diameter of 200 $\mu$m and an outer diameter of 1.4 mm. The coil contains around 40 coils and with a solid length of 8 mm. The SMA is mounted on a 3D printed support containing a flexure-based linear stage which supports the free end of the SMA. The linear stage is 3D printed from PLA and consists of 2 parallel leaf springs with dimensions 500 $\mu$m x 10 mm x 30 mm.

This basic concept can be implemented in using different methods. The latch system can be replaced by a bistable mechanism and can then be paired with antagonistic SMA actuators. Here, the control system can be linked to the snap-through of the bistable mechanism where each stable position controls the heating of each SMA element. In this way, the first SMA can be heated till the snap-through of the bistable mechanism which will then change the electrical contact across the antagonistic SMA. This concept has been implemented and validated in \cref{sec:smabb-gripper}.

\subsection{Sizing of the oscillator}
% Sizing strategies (thermal model) + results
% Stroke : rigidity of flexural linear stages; make reference to LDIA paper
As mentioned previously, the thermomechanical behaviour of the SME is exploited to create the mechanical control system. The sizing of the oscillator system is, thus, directly, dependant on the thermal properties of the active element. The rise time or time till the snap-through occurs, depends on the time required to heat the SMA using Joule's heating. This implies that the current supplied across the SMA dictates the rise time of the oscillator. The fall time or time required to re-establish the electrical contact across the SMA depends on the cooling time of the SMA wire or coil. In the case where the SMA is cooled using passive thermal exchange with the surrounding air, the fall time can be controlled by adequately sizing the diameter of the SMA wire or coil. The amplitude of the system, in this case, depends on the latch system and can be sized using the equation \ref{eq:osc-stroke-sizing}. Furthermore, the stroke of the SMA actuator can be sized using the methods presented in \cref{chap:design-methodology} so as to ensure that the actuator is capable of deforming to the levels demanded by the oscillator amplitude. This will ensure that the snap-through of the oscillator occurs before the SMA overheats.

% Cooling time
The fall time of the control system can be calculated using a simple thermal model based on the passive cooling of the SMA wire or coil. Here, the time constant, $\tau_c$, of the system in which the thermal exchange of heat from the surface of the SMA to the surround air is used to cool down the SMA can be expressed as :
\begin{equation}\label{eq:tau}
  \tau_c = \rho cd/(kH)
\end{equation}
where $\rho$ [kg/m$^3$] is the density, $c$ [J/(kgK)] is the specific heat capacity, $d$ is the wire diameter, $k = 4$ is the ratio between the surface area of heat exchange, $A_S$ and the volume of the active element, $V$, and $H$ [W/(m$^2$K)] is the heat transfer coefficient. The thermal model of the wire can be expressed as :
\begin{equation}\label{eq:thermalmodel}
  T(t) = T_R + (T_2-T_R)e^{-t/\tau}
\end{equation}
where $T_R$ is the ambient room temperature and $t$ is time. Thus, the cooling time, $t_c$, based on the temperature gradient between the SMA and the surrounding air, can be expressed as :
\begin{equation}\label{eq:coolingtime}
  t_c = \tau_c\log{\frac{T_2-T_R+\frac{T_2-T_1}{2}}{T_2-T_R-\frac{T_2-T_1}{2}}}
\end{equation}
where the subscripts, 1 and 2, represents the operating points of the actuator as shown in \cref{chap:design-methodology}. The physical properties of the SMA were obtained by consulting the data given by the supplier at \textit{Dynalloy}.

\begin{figure}[ht] % t for top of the page, H could be put to impose the position of the float
  \centering
  \resizebox{0.8\textwidth}{!}{\input{images/chap6/thermal-fitting.pgf}}
  % \begin{tabular}{r@{ : }l r@{ : }l}
  %   \fcolorbox{black}{myblue}{\rule[1pt]{0pt}{6pt}\rule[1pt]{6pt}{0pt}} & 340 mA & \fcolorbox{black}{myred}{\rule[1pt]{0pt}{6pt}\rule[1pt]{6pt}{0pt}} & 840 mA
  % \end{tabular}
  \caption{Measurement of the heat transfer coefficient, $H$, using 250 $\mu$m wire diameter SMA spring with a mandrel size of 0.5 mm.}
  \label{fig:thermal-fitting}
\end{figure}

Using a thermal camera with an optical zoom that allows for high spatial resolution and using equation \ref{eq:thermalmodel}, least-squares minimization is used to fit this thermal model to the cooling time of an SMA coil of 250 $\mu$m wire diameter. By doing so, the heat transfer coefficient, $H$, can be estimated. Using the model and the estimated parameters, the time constant and cooling times of other diameter SMA springs can be extrapolated. By extrapolating the cooling times of different diameter SMA springs, these values can be used to size this oscillator control system for other applications. In \cref{fig:cooling-time-extrapolation}, the cooling based on wire diameter of different SMA springs can be seen. Using these values, the fall time of the oscillator can be estimated for any wire diameter.

\begin{figure}[ht] % t for top of the page, H could be put to impose the position of the float
  \centering
  \resizebox{0.8\textwidth}{!}{\input{images/chap6/cooling-time-extrapolation.pgf}}
  % \begin{tabular}{r@{ : }l r@{ : }l}
  %   \fcolorbox{black}{myblue}{\rule[1pt]{0pt}{6pt}\rule[1pt]{6pt}{0pt}} & 340 mA & \fcolorbox{black}{myred}{\rule[1pt]{0pt}{6pt}\rule[1pt]{6pt}{0pt}} & 840 mA
  % \end{tabular}
  \caption{Extrapolation of the cooling time based on wire diameter with $H = 43.8$ W/(m$^2$K).}
  \label{fig:cooling-time-extrapolation}
\end{figure}

% Heating time
The rise time of the oscillator, $t_h$, can be estimated by calculating the time required to heat the SMA wire using Joule heating. Using the known resistance of the SMA wire, $R$, and the current, $I$, supplied to the system the heating time can be easily measured using the basic laws of electro-thermodynamics. In the case of slower rise time with small currents, the loss of heat with the surrounding air by convection must be taken into account and can be estimated with the equation :

\begin{equation}\label{eq:heatingtime}
  t_h = \int_{T_1}^{T_2} \frac{\rho Vc}{I^2R(T)-HA_S(T-T_R)} dT
\end{equation}
% \begin{equation}
%   \label{eq:heatingtime}
%   t_h = \[ \int_{T_1}^{T_2} \frac{\rho Vc}{I^2R-HA_S(T-T_R)} \,dT \]
% \end{equation}

The control system was supplied with a constant current and left to oscillate for 2 minutes to test the repeatability and consistency of the rise and fall times. The temperature of the SMA coil was measured using a thermal camera with high spatial resolution and the stroke of the SMA actuator was measured using a laser displacement sensor. In \cref{fig:thermal-osc}, the temperature and position fluctuations of the oscillator are shown. The rise time of the magnetic latch-based control system when supplied with $340$ mA was measured to be $3.8 \pm 0.18$ s while the rise time when supplied with $840$ mA was measured to be $0.64 \pm 0.09$ s. The cooling time when supplied with $340$ mA and $840$ mA was found to be $5.71 \pm 0.09$ s and $5.82 \pm 0.2$ s, respectively. Thus, the period of the oscillations for the two measurements were found to be $9.60 \pm 0.17$ s and $6.47 \pm 0.22$ s which corresponds to a frequency of $0.10$ Hz and $0.16$ Hz.

% Measurement of frequency and duty cycle
\begin{figure}[htb!] % t for top of the page, H could be put to impose the position of the float
  \centering
  \begin{subfigure}[b]{\textwidth}
      \centering
      \resizebox{0.75\textwidth}{!}{\input{images/chap6/sma-osc-temp.pgf}}
  \end{subfigure}
  ~
  \begin{subfigure}[b]{\textwidth}
      \centering
      \resizebox{0.75\textwidth}{!}{\input{images/chap6/sma-osc-pos.pgf}}
  \end{subfigure}
  \begin{tabular}{r@{ }l r@{ }l}
    {\color{myblue} \rule[2pt]{10pt}{0.5mm} } & 340 mA & {\color{myred} \rule[2pt]{10pt}{0.5mm} } & 840 mA
  \end{tabular}
  \caption{Effect of the current on the evolution of the SMA spring's temperature and position.}
  \label{fig:thermal-osc}
\end{figure}

The rise time and cooling times of the latch-based control system were measured by detecting the peaks and troughs of the measured signals. The mean and standard deviation of these values were then calculated. Furthermore, the cooling time predicted, in \cref{fig:cooling-time-extrapolation}, based on the SMA geometry corresponds to the measured values, thus, validating the thermal model. Also, the cooling time remains relatively constant with respect to the varying current across the SMA. The cooling times can, thus, be predicted using the analytical model and the value remains constant, even while varying the current. This implies that the control system can be sized for a fixed fall time by appropriately sizing the SMA wire diameter.

This magnetic latch system allowed the bias-spring SMA actuator to be actuated without any sensors or risk of overheating the SMA. The latch was required to allow the SMA to be heated during the entire stroke of the latch. A system using pogo pins, which are electric contacts consisting of a plunger and a spring mounted inside a barrel, was also tested. This resulted in a behaviour where the bias-spring SMA actuator oscillated at the tip of the pin. This, unfortunately, showcased the need for a latch system to bring the electric contact back to the starting position such that the actuator can carry out its entire stroke during the cooling phase. A latch system based on friction and snap-fits can be designed as an alternative. This pogo pin solution had the unexpected effect of allowing the SMA coil to be maintained at a stable temperature. This effect could be potentially used to stabilise an SMA at a fixed temperature based on the stroke of the pogo pin. The behaviour was not further explored in this paper.

\section{Validation of the Approach using a Case Study}
% Validation of the approach using a case study (introduction)
As stated previously, the requirement of sensors and complex control strategies in certain applications were compactness and being lightweight are required, pollute the overall work-weight density of the robotic system. In this section, to validate the novel design methodology for mechanical control solutions, a lightweight and compact crawling robot powered by shape memory alloys is designed and fabricated. Here, in the creation of an untethered crawling robot, the presence of sensors or micro-controllers will play an important role in the final work density of the system.

In this SMA driven crawling robot, the magnetic latch-based control system is implemented so as to create a small scale robot that can be driven without any sensors or electronics. In this mechanism, the high work density of the SMA is not compromised due to the lack of large biasing-springs and control electronics when compared to examples such as the work by \todocite.

\subsection{Background and Biological Analysis}\label{subsec:bio-analysis}
The mobile robot fabricated using this design approach is inspired by the gait of the inchworm. This insect is not a type of worm but in-fact, a type of caterpillar. These inchworms are known for their peculiar type of locomotion made possible by a looping motion called the two-anchor crawling gait, as described in the work by \todocite. Its gait consists of attaching its forelegs and using the muscles located in its abdomen to pull the rest of its body, as demonstrated in \todocite.

\begin{figure}[ht!] % t for top of the page, H could be put to impose the position of the float
  \centering
  \def\svgwidth{\textwidth}
  \resizebox{\textwidth}{!}{\input{images/chap6/inchworm-gait-diagram.pdf_tex}}
  \caption{The gait analysis of an inchworm showing the insect change the coefficient of friction ($\mu_s$) with respect to the ground by either gripping or sliding its legs.}
  \label{fig:real-inchworm-diagram}
\end{figure}

The gait, as seen in \todocite, consists of alternating between gripping or slipping against the ground. Initially, the forelegs are made to slip while the abdominal muscles push against the hing-legs which are now planted firmly on the ground. Nest, the forelegs are made to grip the ground and the abdominal muscles pull the rest of the body while the hind-legs slide across the ground. This pattern is repeating to allow the inchworm to crawl across the surface. The presented mobile robot exploits this gait to create a similar crawling locomotion.

\subsection{Working principle and Implementation of the Robot}

The basic working principle of this mobile robots consists of implementing the design methodology presented in \cref{chap:design-methodology} and the magnetic latch-based control system. Here, the linear movement of the SMA oscillator is transformed into a rotation of a pair of legs such that the tips or claws of the leg pulls the body of the insect robot across the ground.

As seen in \cref{fig:insect-proto-diagram}, the inchworm robot is entirely 3D printed in a single piece and is powered using an SMA coil. The control system used in this design is based on the approach detailed in \cref{sec:magnetic-latch}. The legs of the insect robot is attached to the end-effector of the SMA actuator so as to harness the strain recovery when the SMA coil is heated using Joule's heating. Here, as detailed in \cref{chap:design-methodology}, the biasing element of the SMA actuator consists of a flexure-based cantilever leaf spring. This biasing element also acts as a simple kinematic stage that transforms the SMA linear strain recovery into a rotation of the robot legs.

\begin{figure}[hbt!] % t for top of the page, H could be put to impose the position of the float
    \centering
    \scalebar{
    \begin{annotatedFigure}
    	{\includegraphics[trim={19cm 0cm 22cm 0cm},clip,width=0.7\textwidth]{images/chap6/insect-proto-bentleg.jpg}}
    	% \annotatedFigureBox{0.165,0.6493}{0.3111,0.9739}{A}{0.165,0.6493}{myblue}%bl
      % \node at (0.1595,0.8813) [fill=none,ultra thick,shape=circle,draw=white,inner sep=2pt,font=\sffamily,text=white, opacity=0.8] {\textbf{A}};
      \node [anchor=east, rotate=0] (ML) at (0.1895,0.8813) {\color{white} \normalsize \makecell[r]{Magnetic\\latch}};

      % \node at (0.1595,0.5313) [fill=none,ultra thick,shape=circle,draw=white,inner sep=2pt,font=\sffamily,text=white, opacity=0.8] {\textbf{B}};
      \node [anchor=east, rotate=82] (MLS) at (0.1855,0.663) {\color{white}Leaf spring};

    	% \node at (0.3755,0.6113) [fill=none,ultra thick,shape=circle,draw=black,inner sep=2pt,font=\sffamily,text=black, opacity=0.8] {\textbf{C}};
      \node [anchor=west, rotate=0] (SMALS) at (0.3605,0.5513) {\color{mygreen} \normalsize \makecell[l]{Bias\\leaf spring}};
      % \node [anchor=east, rotate=85] (SMALS) at (0.3405,0.6513) {\color{black} \footnotesize SMA leaf spring};

      % \node at (0.613,0.623) [fill=none,ultra thick,shape=circle,draw=white,inner sep=2pt,font=\sffamily,text=white, opacity=0.8] {\textbf{D}};
      \node [anchor=west, rotate=-42] (SMAC) at (0.613,0.623) {\color{white} SMA};

      % SMA Cantilever
      \node (sbot) at (0.26,0.31) {};
      \node (stop) at (0.33,0.69) {};
      \draw[dashed,ultra thick,color=mygreen] (sbot) to [bend left=8] (stop);
    \end{annotatedFigure}
    }{197.8}{2.2}{20}
%   \includegraphics[trim={3cm 5cm 3cm 3cm},clip, width=0.75\textwidth]{img/transducer.jpg}

    % \begin{tabular}{r@{ }l r@{ }l}
    %     A : & Magnetic latch & B : & Magnet cantilever leaf spring\\
    %     C : & SMA coil & D : & SMA cantilever leaf spring\\
    % \end{tabular}
    \caption{The implementation of the insect robot around the mechanical SMA oscillator.}
    \label{fig:insect-proto-diagram}
\end{figure}

The insect robot operates in a similar manner to the inchworm presented in \cref{subsec:bio-analysis} where the claws alternate between high friction and low friction with respect to the ground. By activating its artificial abdominal muscle consisting of the SMA coil, the insect robot is able to crawl across the ground. Here, the alternating friction that occurs at the claws is due to the design of the tips of the insect legs. The angle of the legs as the robot moves changes the angle of contact with the ground surface. As the leg tip design is asymmetrical with the direction of movement, the rotation of the legs cause alternating high and low friction. The behaviour is similar to a ratchet system where one degree of freedom is allowed in the forward direction but not in the backward direction. Here, the claw design allows rotation in the clockwise direction but prevents some rotation in the anti-clockwise direction. As the SMA is heated, the insect robot moves its forelegs away from the body. Then, when the SMA coil is stretch by the biasing leaf spring during cooling, the forelegs grip the ground and drags the rest of the body along the ground. By repeatedly heating and cooling the SMA, the insect robot can gradually move across the ground. As detailed in this novel control strategy, the magnetic latch system allows the SMA to oscillate and control the steps of the insect robot without any micro-controllers or electronics.

\subsection{Analytical model of the Biasing Compliant Mechanism}

When sizing the design and SMA of the insect robot, an analytical model of the compliant mechanism is required. This models allows dimensioning the SMA coil such that sufficient stroke is observed during the shape memory effect. Here, the stroke of the SMA actuator or the contraction of the SMA coil corresponds to the estimated step length of the insect robot.

The crux of the design revolves around the flexure-based biasing element and kinematic stage which, in this design, consists of a simple cantilever leaf spring. This flexural structure converts the linear contraction of the SMA coil into the rotation of the insect legs while also serving as the bias spring for SMA actuator allowing the coil to be stretched during the cooling phase based on the design approach detailed in \cref{chap:design-methodology}.

\begin{figure}[hbt!] % t for top of the page, H could be put to impose the position of the float
   \centering
   \begin{tikzpicture}
     \begin{scope}[x={(graph.south east)},y={(graph.north west)}]
       \coordinate (P) at (0.295,0.56);
       \coordinate (P0) at (0.17,0.65);
       \coordinate (S) at (0.55,0.16);
       \coordinate (V) at (0.145,0.33);
       \coordinate (C) at (0.058,0.02);
         \node[anchor=south west,inner sep=0] (image) at (0,0) {\includegraphics[trim={0 0cm 0 0cm},clip, width=0.5\textwidth]{images/chap6/insect-walking-diagram.pdf}};
         \node [anchor=west] (hfrictext) at (-0.030,0.05) {$\uparrow\mu_s$};
         \node [anchor=west] (lfrictext) at (0.25,0.05) {$\downarrow\mu_s$};
         \filldraw[black] (P) circle (2pt) node[anchor=south east,shift={(-0.02,0)}] {\normalsize P};
         \filldraw[black] (S) circle (2pt) node[anchor=north] {\normalsize S};
         \filldraw[black] (V) circle (2pt) node[anchor=north west,shift={(0.015,0)}] {\normalsize V};
         \filldraw[black] (C) circle (2pt) node[label={[shift={(0.02,-0.02)}]\normalsize C}] {};
         \draw[decoration={aspect=0.3, segment length=1mm, amplitude=0.3mm,coil},decorate] (P) -- node[above, rotate = -42] {\normalsize$r_2$} (S);
         \draw[decoration={aspect=0.3, segment length=1mm, amplitude=0.3mm,coil},decorate, opacity=0.5] (P0) -- node[below, rotate = -40,opacity=0.5] {\normalsize $L'_{SMA}$} (S);
         % \draw[dashed] (P) -- (S);

         % For claw only figure
         % \node [anchor=west, rotate=-62] (lfrictext) at (2.4,2.1) {\footnotesize Low friction};
         % \node [anchor=west, rotate=70] (hfrictext) at (0,0.3) {\footnotesize High friction};
         % Grid
         % \draw[lightgray,step=0.1] (image.south west) grid (image.north east);
         % \foreach \x in {0,0.1,...,1} { \node [below, rotate=-90] at (\x,0) {\tiny \x}; }
	     %    \foreach \y in {0,0.1,...,1} { \node [left] at (0,\y) {\tiny \y};}
     \end{scope}
     % \draw [brown] (current bounding box.south west) rectangle (current bounding box.north east);
   \end{tikzpicture}%
   ~
   \resizebox{0.3\textwidth}{!}{
   \begin{tikzpicture}
     \coordinate (rigid-top) at (0.75,1.5);
     \coordinate (deflected-top) at (0.5,0.65);
     \coordinate (top) at (0,1.5);
     \coordinate (bot) at (0,-1.5);
     \coordinate (virtual-pivot) at (0,-1);
     \filldraw[black] (virtual-pivot) circle (1pt) node[anchor=east] {V};
     \draw[line width=1.5mm] (-0.25,-1.5) -- (0.25,-1.5); % Ground
     \draw[dashed] (bot) -- (top);
     \draw[dashed] (virtual-pivot) -- (rigid-top);
     \draw[line width=0.5mm] (bot) to [bend left=5.5] (deflected-top); % cantilever
     \draw[line width=1mm] (deflected-top) -- (rigid-top); % rigid cantilever

     % Annotations
     \draw[|-|, line width=0.2mm] ($ (bot) + (0.6,0) $) -- node[anchor=west]{\scriptsize$aL$} ($ (virtual-pivot) + (0.6,0) $);
     \draw[|-|, line width=0.2mm] ($ (bot) + (-0.5,0) $) -- node[anchor=east]{\scriptsize$L$} ($ (0,0.65) + (-0.5,0) $);
     \draw[|-|, line width=0.2mm] ($ (deflected-top) + (0.5,-0.15) $) -- node[anchor=west]{\scriptsize$bL$} ($ (rigid-top) + (0.5,-0.15) $$);
     \draw (0,0.6) node[anchor=south west]{$\theta$} arc (90:76:2);
     % \dimline[line style = {line width=0.5}]{$ (bot) + (0.6,0) $}{$ (virtual-pivot) + (0.6,0) $}{$aL$};
     % \path ($ (bot) + (0.6,0) $) to[dim below=$aL$] ($ (virtual-pivot) + (0.6,0) $);
     % \path ($ (bot) + (-0.25,0) $) to[dim above=$L$] ($ (0,0.65) + (-0.25,0) $);
     % \path ($ (deflected-top) + (0.5,-0.15) $) to[dim below=$bL$] ($ (rigid-top) + (0.5,-0.15) $);
     % \pic ["$\theta$", draw, -, angle eccentricity=1.2, angle radius=1.5cm] {angle = deflected-top--virtual-pivot--top};
   \end{tikzpicture}%
   }
  \caption{The working principle of the insect robot showing the simplification of the cantilever beam to a virtual rigid body pivot. The claw design changes the coefficient of friction ($\mu_s$) of the insect with respect to the ground allowing the robot to crawl.}
  \label{fig:insect-claw-diagram}
\end{figure}

The pseudo-rigid-body model, as described in the work by \cite{howellHandbookCompliantMechanisms2013}, is used to model flexure-based mechanisms such as the cantilever beam as traditional rigid-body mechanisms. Thus, by simplifying the cantilever leaf spring as a virtual pivot, an analytical model can be established to estimate the effect of the SMA coil contraction. In the work by \cite{zhangRealPivotStructure2007}, the location of the virtual pivot can be estimated with relative accuracy to a point at a distance of $aL$ from the clamped end of the cantilever beam, where $L$ is the length of the beam, $bL$ is the length of the rigid attachment point with the SMA coil and $a$ is:

\begin{equation}\label{eq:virtual-pivot-a}
a = \frac{1+3b}{3+6b}
\end{equation}

The pre-stretched SMA coil of length, $L'_{SMA}$, is attached to the biasing cantilever leaf spring at the free end as shown in \cref{fig:insect-claw-diagram}. The position of cantilever tip, $P(x_P,y_P)$, as the SMA coil contracts in length by $\varepsilon$, can be deduced by finding the intersection between the two circles with radii, $r_1$ and $r_2$, and with centres at the virtual pivot $V(x_V,y_V)$ and fixed end of the SMA coil $S(x_S,y_S)$, respectively.

\begin{equation}\label{eq:cc-intersect}
  P(x,y) = \frac{1}{2}\begin{pmatrix} x_V+x_S \\ y_V+y_S \end{pmatrix}+\frac{r_1^2-r_2^2}{2R^2}\begin{pmatrix} x_S-x_V \\ y_S-y_V\end{pmatrix}\pm\frac{1}{2}\sqrt{2\frac{r_1^2+r_2^2}{R^2}-\frac{(r_1^2-r_2^2)^2}{R^4}-1}\begin{pmatrix} y_S-y_V \\ x_V-x_S\end{pmatrix}
\end{equation}
where $R$ is the Euclidean distance, $|\overline{VS}|$, between the two circle centres, $r_1 = (1-a+b)L$ and $r_2 = L'_{SMA}-\varepsilon$ representing the current length of the SMA coil.

As the insect legs are attached at the cantilever tip, the claw tips, $C(x_C,y_C)$, of the insect robot can be estimated by using a series of simple translation and rotation transformations from the cantilever tip based on the angles ($\alpha$) and lengths ($L$) of the insect leg segments.

\begin{equation}\label{eq:C}
  C(x,y) = \begin{pmatrix} x_P \\ y_P \end{pmatrix} + \sum_{i=1}L_i\begin{pmatrix} \cos(-\frac{\pi}{2}-\theta+\sum_{i=1}\alpha_i) \\ \sin(-\frac{\pi}{2}-\theta+\sum_{i=1}\alpha_i) \end{pmatrix}
\end{equation}
% \begin{multline}\label{eq:C}
%   \qquad C(x,y) = \begin{pmatrix} x_P \\ y_P \end{pmatrix} \\+ \sum_{i=1}L_i\begin{pmatrix} \cos(-\frac{\pi}{2}-\theta+\sum_{i=1}\alpha_i) \\ \sin(-\frac{\pi}{2}-\theta+\sum_{i=1}\alpha_i) \end{pmatrix}
% \end{multline}

Thus, based on the contraction or strain recovery of the SMA coil ($\varepsilon$), the step length of the insect, $\Delta C$, can be estimated by taking the Euclidean distance between the claw tip location before and after the SMA contraction. The position of the insect robot claw and the step length based on the SMA coil contraction can be seen in \cref{fig:insect-am-fem-compare}.

\begin{figure}[hb!] % t for top of the page, H could be put to impose the position of the float
  \centering
  \resizebox{0.95\columnwidth}{!}{\input{images/chap6/insect-am-fem-compare.pgf}}
  \caption{Comparison of the leg tip displacement versus the contraction of the SMA coil between the analytical model (AM) and Finite Element Model (FEM) simulation. Here, the dotted and filled lines represent the FEM results and analytical model, respectively.}
  \label{fig:insect-am-fem-compare}
\end{figure}

% \subsection{Results and Discussion}
\subsection{Implications of the Prototype}
As detailed in the methodology, the analytical model of the inchworm robot that determines the relationship between the contraction of the SMA during actuation and the estimated step length was first estimated. This design was simulated using a commercial finite element modelling (FEM) software which was then used to validate the analytical model, as shown in \cref{fig:insect-am-fem-compare}. Furthermore, the experimental results obtained from the inchworm prototype was used to validate the model, as shown in the same figure. This comparison shows that the pseudo-rigid body model used to model the design is quite accurate and can thus be used to further optimize the step length in future iterations.

% Step figures
\begin{figure}[hbt!] % t for top of the page, H could be put to impose the position of the float
\centering
  \begin{subfigure}[b]{0.4\columnwidth}
      \centering
      \begin{annotationimage}{trim={9.5cm 8cm 30cm 8cm},clip,width=\textwidth}{images/chap6/insect-gait-1_8092617,000.png}
        \draw[image label = {$0\,\mathrm{s}$ at north east}];
      \end{annotationimage}
      \label{subfig:step-1}
  \end{subfigure}\\[-2.4ex]
  \begin{subfigure}[b]{0.4\columnwidth}
      \centering
      \begin{annotationimage}{trim={9.5cm 8cm 30cm 8cm},clip,width=\textwidth}{images/chap6/insect-gait-2_9270812,000.png}
        \draw[image label = {$1\,\mathrm{s}$ at north east}];
      \end{annotationimage}
      \label{subfig:step-2}
  \end{subfigure}\\[-2.4ex]
  \begin{subfigure}[b]{0.4\columnwidth}
      \centering
      \begin{annotationimage}{trim={9.5cm 8cm 30cm 8cm},clip,width=\textwidth}{images/chap6/insect-gait-3_14228023,000.png}
      \draw[image label = {$6\,\mathrm{s}$ at north east}];
     \end{annotationimage}
      \label{subfig:step-3}
  \end{subfigure}
\caption{The untethered gait of the insect robot with a step length of $8.4$ mm. As predicted, the snap-through of the magnetic latch halts the heating of the SMA coil.}
\label{fig:insect-gait}
\end{figure}

\begin{table}[hbt!]
    \centering
    \caption{The design parameters of the inchworm robot.}
    \label{tab:design-parameters}
    {\rowcolors{1}{black!5}{black!10}
     \begin{tabular}{r l}
     % \thickhline
     \rowcolor{black} \textbf{\color{white} Parameter}  & \textbf{\color{white} Value}                                                                                        \\
     SMA dimensions & \begin{tabular}[c]{@{}l@{}}Coil: $\varnothing1.37\times12\,\mathrm{mm}$\\Wire: $\varnothing0.2\,\mathrm{mm}$\end{tabular}                                                                                         \\
     Biasing Leaf Spring & $30\times10\times0.6\,\mathrm{mm}$                                                                                    \\
     Magnet Leaf Spring  & $30\times2.5\times0.6\,\mathrm{mm}$                                                                                    \\
     Magnet force        & $250$ g                                                                                         \\
     Battery Life        & $1.6$ min @ $20$ mAh                                                                               \\
     % Leg dimensions      & \begin{tabular}[c]{@{}c@{}}$L_i = [20\,\mathrm{mm}, 33.5\,\mathrm{mm}]$\\ $ \alpha_i = [0$\textdegree$, 26.6$\textdegree]\end{tabular} \\ \thickhline
 \end{tabular}}
\end{table}

Due to the design being based on flexure-based structure, the inchworm could be fabricated from a single 3D printed piece. The structure was printed from PLA filament using fused deposition fabrication based on the parameters shown in \cref{tab:design-parameters}. Due to the novel control system based on the magnetic latch, when connecting the robot to a $20$ mAh battery, the robot is able to crawl untethered , as shown in \cref{fig:insect-gait}, for an estimated $1.6$ min. When allowed to crawl on a flat surface, the average speed of the insect robot was measured to be $1.55$ mms$^{-1}$, as shown in \cref{fig:insect-disp}. The efficiency of the leg design is highly dependant on the surface; smoother surfaces cause the legs to slip and drastically changes the overall efficiency of the design.

\begin{figure}[hbt!] % t for top of the page, H could be put to impose the position of the float
  \centering
  \resizebox{0.9\columnwidth}{!}{\input{images/chap6/insect-disp.pgf}}
  % \begin{tabular}{r@{ }l r@{ }l}
  %   {\color{myblue} \rule[2pt]{10pt}{0.5mm} } & 340 mA & {\color{myred} \rule[2pt]{10pt}{0.5mm} } & 840 mA
  % \end{tabular}
  \caption{The displacement of the insect robot. The average speed of the robot is $1.55$ mms$^{-1}$. Here, the step line represents the state of the SMA. A high value denotes that the SMA coil is being heated and a low state denotes that the SMA coil is cooling down.}
  \label{fig:insect-disp}
\end{figure}

As stated, the principle advantage to the novel control system approach is the absence of sensors or micro-controllers. Using this methodology, the total weight of the robot including the battery weights $9.7$ g. The insect robot is powered using only a single SMA coil. As with most SMA actuators, the coil is heated using Joule's heating by passing a current through it. Here, the heating consists of passing a $770$ mA current for a duration of $750$ ms with a power of $1.7$ W. As shown in \cref{fig:insect-am-fem-compare}, the step length of the insect robot was measured to be $8$ mm.

Often, in the case of mobile robots, especially bio-inspired robots, the cost of transport (CoT) is calculated to compare the design and implementation. This factor allows the comparison of mobile robots with varying structures, sizes and gaits. It can be calculated using the following equation :
\begin{equation}\label{eq:CoT}
    \textrm{CoT} = \frac{E}{mgd}
\end{equation}
where $E$ is the energy required to heat the SMA, $m$ is the total mass of the robot including the battery, $g$ is the acceleration due to gravity and $d$ is the step length of the robot. Using the equation, the CoT was calculated to be around 1620 Jkg$^{-1}$m$^{-1}$. This is comparable to other untethered inchworm robots like in the work by \cite{jiAutonomousUntetheredFast2019} whose CoT is measured to be 1670 Jkg$^{-1}$m$^{-1}$. However, when compared to other inchworm robots, as shown in \cref{tab:literature-compare}, this work is limited in the overall speed. This can be explained due to the inefficiency in the claw design and the dependence on the friction with the ground. The design, while being cheap and easily fabricated using 3D printing, it is limited by the PLA material. By optimizing the material to create thinner leaf springs, the size of the robot can be greatly reduced. Future work will have to include the optimization of the claw design and improve the overall efficiency of the insect robot's claw design to prevent slipping.

% \afterpage{%
% \clearpage% Flush earlier floats (otherwise order might not be correct)
% \begin{landscape}
\begin{table}[hbt!]
 \centering
 \hfill
 \caption{Comparison of various different smart material based mobile robots using data from the work by \cite{jiAutonomousUntetheredFast2019}}
 \label{tab:literature-compare}
 {\rowcolors{3}{black!5}{black!10}
% \begin{tabular}{lccccc}
\begin{tabular}{p{3.5cm}P{2cm}P{1.5cm}P{1.5cm}P{1.25cm}P{2.25cm}}
 % \begin{tabu} to 1\textwidth {X[l, 2] X[l, 0.75] X[l,0.75] X[l,1] X[l,1] X[l,1.25]}
   % \rowcolor{black} & \textbf{\color{white} Robot length (BL)} & \textbf{\color{white} Speed} & \textbf{\color{white} Speed} & \textbf{\color{white} Total weight}  & \textbf{\color{white} Speed / weight} \\
   % \rowcolor{black} \multirow{-2}{2cm}{\textbf{\color{white} Smart Material Technology}} & \textbf{\color{white} [mm]} & \textbf{\color{white} [mms$^{-1}$]} & \textbf{\color{white} [BLs$^{-1}$]} & \textbf{\color{white} [g]} & \textbf{\color{white} [BLs$^{-1}$ per g]} \\
   \rowcolor{black} \textbf{\color{white} Smart Material Technology} & \textbf{\color{white} Robot length (BL) [mm]} & \textbf{\color{white} Speed [mms$^{-1}$]} & \textbf{\color{white} Speed [BLs$^{-1}$]} & \textbf{\color{white} Total weight [g]}  & \textbf{\color{white} Speed / weight [BLs$^{-1}$ per g]} \\
   \textbf{SMA [This work]}          & 60                         & 1.55              & 0.03              & 9.7                  & 0.003                          \\
   SMA [\cite{kohOmegaShapedInchwormInspiredCrawling2013}] & 150 & 10 & 0.07 & 1.2 & 0.055\\
   SMA [\cite{huangChasingBiomimeticLocomotion2018}]                          & 57                         & 34                & 0.6               & $\sim$20             & 0.03                           \\
   DEA [\cite{jiAutonomousUntetheredFast2019}]                         & 40                         & 12                & 0.3               & 0.97                 & 0.3                            \\
   DEA [\cite{caoUntetheredSoftRobot2018}]                          & 200                        & 4                 & 0.02              & 252.6                & $8\times10^{-5}$                         \\
   Pneumatic actuator [\cite{tolleyResilientUntetheredSoft2014}] & 650                        & 5                 & 0.008             & $\sim$4000           & $2\times10^{-6}$                         \\
   IPMC [\cite{mustIonicCapacitiveArtificial2015}]                         & 45                         & 0.45              & 0.01              & 0.83                 & 0.01                           \\
 % \end{tabu}
\end{tabular}}
\end{table}
% \end{landscape}
% \clearpage% Flush page
% }
\section{Summary and Conclusion}
In this chapter, a novel approach to design a mechanical control system is presented. In this methodology, the control stage of a traditional SMA actuator is integrated into the kinematic stage of the actuator. This results in a control mechanism that uses the thermomechanical behaviour of the SMA such that the system no longer requires any sensors or electronics.

Furthermore, a basic implementation of such a system is presented using a magnetic latch-based system. Using a magnet and flexure-based cantilever leaf springs, a magnetic latch was designed and implemented where after a certain stroke threshold, results in an instantaneous snap-through. This rapid bifurcation is exploited to instantly disconnect mechanically the electrical contact across the SMA and thus, preventing any overheating. This design principle was implemented by fabricating a basic SMA mechanical oscillator that requires no sensors or electronics to oscillate.

Lastly, the design methodology was validated using a case study consisting of an untethered crawling insect robot powered by a single SMA coil. Here, based on the presented design methodology, a biasing flexure-based SMA actuator was modelled and sized to power the crawling robot. Furthermore, the control system presented in this chapter, was implement using the magnetic latch system so as to create a reversible control scheme for the SMA actuator. The kinematic stage, which acts as the biasing element of the SMA actuator, is exploited within the control system. Based on the results from the locomotion of the insect robot, a regular step size and walking speed is observed, thus, validating the design approach presenting in this chapter.

Using the methodology presented in this chapter, a novel control system can be designed and sized such that the SMA actuator can be controlled without the need for bulky sensors and micro-controllers and without the risk of overheating the SMA element.
